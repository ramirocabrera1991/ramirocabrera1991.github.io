import{_ as j,r as i,e as D,f as L,g as f,h as Q,i as r,c as I,a as n,d as t,w,v as y,j as c,o as C,F as z,k as M,p as O,b as J,t as b,l as g,m as R}from"./index-Cf10pcfz.js";import{_ as $}from"./NavBar-gTDz9vQE.js";const m=p=>(O("data-v-22c4458b"),p=p(),J(),p),G={class:"formulario"},H=m(()=>t("label",{class:"arc-text"},"NUEVA FACTURA",-1)),K=m(()=>t("br",null,null,-1)),W={class:"campo"},X={class:"campo"},Y={class:"campo"},Z=m(()=>t("label",{class:"lbl",for:"cantidad"},"Cantidad:",-1)),ee=m(()=>t("hr",null,null,-1)),te={class:"campo"},ae=m(()=>t("label",{for:"total"},"Total:",-1)),le=m(()=>t("label",{for:"totalQuantity"},"Cantidad TOTAL:",-1)),oe={__name:"NewInvoiceView",setup(p){const h=i([]),P=i([]),_=i(""),o=i(""),s=i(1),u=D([]),d=i(0),v=i(0);i(!1),L(()=>{if(f.getUserLogged().id=="")return Q.push("/");f.getAllCustomersByUser().then(e=>{switch(e.status){case 200:h.value=e.data}}).catch(e=>{console.log(e.message)}),f.getAllProducts().then(e=>{switch(e.status){case 200:P.value=e.data}}).catch(e=>{console.log(e.message)})});const U=()=>{if(o.value!=""&&s.value>0){let l=null;if(u.length>0&&u.forEach(e=>{l=e.product.idProduct==o.value.idProduct?e:null}),l)l.quantity+=s.value,l.subtotal=l.quantity*l.unitPrice,d.value+=l.cost*s.value,v.value+=s.value;else{const e={product:o.value,name:o.value.name,unitPrice:o.value.unitPrice,cost:o.value.cost,quantity:s.value,subtotal:s.value*o.value.unitPrice};d.value+=o.value.unitPrice*s.value,v.value+=Number(s.value),u.push(e),o.value="",s.value=1}}else alert("Por favor, complete todos los campos antes de agregar el producto.")},k=()=>{if(!_.value){alert("Por favor, seleccione un cliente.");return}if(u.length==0){alert("Debes cargar al menos 1 producto.");return}const l={user:{idUser:JSON.parse(localStorage.getItem("user")).id},customer:{idCustomer:_.value.idCustomer},listItemsInvoice:u,total:d.value};f.newInvoice(l).then(e=>{switch(e.status){case 200:alert("Factura guardada con exito"),A()}}).catch(e=>{console.log(e.message)}),console.log("Productos finales:",l)},A=()=>{h.value="",P.value="",_.value="",o.value="",s.value="1",u.length=0},N=l=>{u.splice(l,1),d.value=0,v.value=0,u.forEach(e=>{d.value+=e.cost*e.quantity,v.value+=e.quantity})};return(l,e)=>{const S=r("v-autocomplete"),T=r("v-card-title"),V=r("v-card-subtitle"),q=r("v-btn"),F=r("v-card-actions"),x=r("v-card"),B=r("v-col"),E=r("v-row");return C(),I("div",null,[n($),t("div",G,[H,K,t("div",W,[n(S,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),items:h.value,label:"Cliente",placeholder:"Seleccionar un cliente","item-title":"customerName","item-value":"idCustomer","return-object":""},null,8,["modelValue","items"])]),t("div",X,[n(S,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),items:P.value,label:"Articulo",placeholder:"Seleccionar un articulo","item-title":"name","item-value":"idProduct","return-object":""},null,8,["modelValue","items"])]),t("div",Y,[Z,w(t("input",{id:"cantidad","onUpdate:modelValue":e[2]||(e[2]=a=>s.value=a),type:"number",min:"1",style:{flex:"0"}},null,512),[[y,s.value,void 0,{number:!0}]])]),t("button",{class:"btn",onClick:U},"Agregar"),ee,n(x,null,{default:c(()=>[n(E,{dense:""},{default:c(()=>[n(B,null,{default:c(()=>[(C(!0),I(z,null,M(u,a=>(C(),R(x,{class:"card",color:"#385F73",theme:"dark",key:a.name,cols:"12",sm:"12",md:"6"},{default:c(()=>[n(T,{class:"text-h5"},{default:c(()=>[g(b(a.name),1)]),_:2},1024),n(V,null,{default:c(()=>[g("Cantidad: "+b(a.quantity),1)]),_:2},1024),n(V,null,{default:c(()=>[g("Precio u: "+b(a.unitPrice),1)]),_:2},1024),n(V,null,{default:c(()=>[g("SubTotal: "+b(a.subtotal),1)]),_:2},1024),n(F,null,{default:c(()=>[n(q,{icon:"mdi-delete",variant:"plain",onClick:N,color:"error"})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t("div",te,[ae,w(t("input",{class:"totales",id:"total","onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),disabled:""},null,512),[[y,d.value]]),le,w(t("input",{class:"totales",id:"totalQuantity","onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),disabled:""},null,512),[[y,v.value]])]),t("button",{class:"btn",onClick:k},"Finalizar")])])}}},ue=j(oe,[["__scopeId","data-v-22c4458b"]]);export{ue as default};
